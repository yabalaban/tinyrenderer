<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TinyRenderer - Software 3D Renderer in Nim</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #00ff88, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #888;
      margin-bottom: 20px;
      font-size: 0.9rem;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .canvas-wrapper {
      border: 2px solid #00ff8855;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
    }

    #canvas {
      display: block;
      cursor: grab;
    }

    #canvas:active {
      cursor: grabbing;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    select, button {
      padding: 10px 20px;
      font-size: 14px;
      border: 1px solid #00ff8855;
      border-radius: 5px;
      background: #1a1a2e;
      color: #00ff88;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    select:hover, button:hover {
      background: #00ff8822;
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
    }

    select:focus, button:focus {
      outline: none;
      border-color: #00ff88;
    }

    #status {
      font-size: 0.85rem;
      color: #00d4ff;
      min-height: 20px;
    }

    .info {
      max-width: 600px;
      text-align: center;
      font-size: 0.85rem;
      color: #666;
      margin-top: 20px;
      line-height: 1.6;
    }

    .info a {
      color: #00ff88;
      text-decoration: none;
    }

    .info a:hover {
      text-decoration: underline;
    }

    .tech-badge {
      display: inline-block;
      padding: 3px 8px;
      background: #00ff8822;
      border-radius: 3px;
      font-size: 0.75rem;
      color: #00ff88;
      margin: 0 2px;
    }
  </style>
</head>
<body>
  <h1>TinyRenderer</h1>
  <p class="subtitle">Software 3D Renderer compiled from <span class="tech-badge">Nim</span> to <span class="tech-badge">JavaScript</span></p>

  <div class="container">
    <div class="canvas-wrapper">
      <canvas id="canvas"></canvas>
    </div>

    <div class="controls">
      <select id="modelSelect" onchange="loadSelectedModel()">
        <option value="african_head" data-model="models/african_head.obj" data-texture="models/african_head_diffuse.png">African Head</option>
        <option value="diablo3_pose" data-model="models/diablo3_pose.obj" data-texture="models/diablo3_pose_diffuse.png">Diablo 3 Pose</option>
      </select>
      <button id="autoRotateBtn" onclick="toggleAutoRotate()">Auto-Rotate: ON</button>
      <button onclick="clearCacheAndReload()" style="border-color: #ff6b6b55; color: #ff6b6b;">â†» Clear Cache</button>
    </div>

    <div id="status">Loading...</div>
  </div>

  <div class="info">
    <p>
      This is a software renderer running entirely in your browser.
      No WebGL - just pixel-by-pixel rendering on a 2D canvas.
      The Nim source code is compiled to JavaScript.
    </p>
    <p style="margin-top: 10px;">
      <a href="https://github.com/ssloy/tinyrenderer" target="_blank">Based on tinyrenderer</a>
    </p>
  </div>

  <script>
    // Load model from select dropdown
    function loadSelectedModel() {
      const select = document.getElementById('modelSelect');
      const option = select.options[select.selectedIndex];
      const modelUrl = option.getAttribute('data-model');
      const textureUrl = option.getAttribute('data-texture');
      selectModel(modelUrl, textureUrl);
    }

    // Cache-busting: add timestamp to script URL
    function clearCacheAndReload() {
      // Clear caches if available
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name));
        });
      }
      // Force reload with cache bust
      window.location.href = window.location.pathname + '?v=' + Date.now();
    }
  </script>
  <script src="renderer.js"></script>
</body>
</html>
